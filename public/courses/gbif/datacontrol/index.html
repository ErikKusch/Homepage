<!DOCTYPE html><html lang="en-gb" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Erik Kusch">

  
  
  
    
  
  <meta name="description" content="A quick overview of data retrieval with `rgbif`.">

  
  <link rel="alternate" hreflang="en-gb" href="https://www.erikkusch.com/courses/gbif/datacontrol/">

  


  
  
  
  <meta name="theme-color" content="#858383">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cutive+Mono%7CLora:400,700%7CRoboto:400,700&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-186216138-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-186216138-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu7658c99d512131214e4d6c003a3f85f7_112593_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu7658c99d512131214e4d6c003a3f85f7_112593_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://www.erikkusch.com/courses/gbif/datacontrol/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@ErikKusch">
  <meta property="twitter:creator" content="@ErikKusch">
  
  <meta property="og:site_name" content="Erik Kusch">
  <meta property="og:url" content="https://www.erikkusch.com/courses/gbif/datacontrol/">
  <meta property="og:title" content="Handling Data with rgbif | Erik Kusch">
  <meta property="og:description" content="A quick overview of data retrieval with `rgbif`."><meta property="og:image" content="https://www.erikkusch.com/img/%C3%A5motdalshytta.jpg">
  <meta property="twitter:image" content="https://www.erikkusch.com/img/%C3%A5motdalshytta.jpg"><meta property="og:locale" content="en-gb">
  
    
      <meta property="article:published_time" content="2023-05-21T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2023-11-06T20:00:00&#43;01:00">
  

  



  


  


  





  <title>Handling Data with rgbif | Erik Kusch</title>

</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  








  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/images/logo_huab2266ff59bbac6a094b6da1268adcf9_208479_0x70_resize_lanczos_2.png" alt="Erik Kusch"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/images/logo_huab2266ff59bbac6a094b6da1268adcf9_208479_0x70_resize_lanczos_2.png" alt="Erik Kusch"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-center" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Courses & Workshops</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/courses/krigr/"><span>KrigR - State-of-the-Art Climate Data within R</span></a>
            
              <a class="dropdown-item" href="/courses/gbif/"><span>Accessing and Referencing GBIF Data for Research</span></a>
            
              <a class="dropdown-item" href="/courses/rethinking/"><span>Statistical Rethinking - Introduction to Bayesian Statistics</span></a>
            
              <a class="dropdown-item" href="/courses/bayes-nets/"><span>Bayesian Networks - Causality through Bayesian Approaches</span></a>
            
              <a class="dropdown-item" href="/courses/biostat101/"><span>Biostats 101 - An Introduction to Biostatistics</span></a>
            
              <a class="dropdown-item" href="/courses/excursions-into-biostatistics/"><span>Biostats 301 - Excursions into Biostatistics</span></a>
            
              <a class="dropdown-item" href="/courses/bftp-biome-detection/"><span>BFTP - First Steps in Macroecology in R</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="https://htmlpreview.github.io/?https://github.com/ErikKusch/Homepage/blob/master/static/media/CV_ErikKusch.html" target="_blank" rel="noopener"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/gbif/">Introduction</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/gbif/">Motivation &amp; Workshop</a>
      </li>
      
      <li >
        <a href="/courses/gbif/theory/">An Introduction to GBIF &amp; rgbif</a>
      </li>
      
      <li >
        <a href="/courses/gbif/setup/">Setting up rgbif</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/gbif/backbone/">LivingNorway</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/gbif/backbone/">Working with the GBIF Backbone</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/gbif/nfdi-download/">NFDI4Biodiversity</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/gbif/nfdi-download/">Finding &amp; Downloading Data with rgbif</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/gbif/datadiscovery/">Practical Exercises</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/gbif/datadiscovery/">Discovering Data with rgbif</a>
      </li>
      
      <li >
        <a href="/courses/gbif/datadownload/">Downloading Data with rgbif</a>
      </li>
      
      <li class="active">
        <a href="/courses/gbif/datacontrol/">Handling Data with rgbif</a>
      </li>
      
      <li >
        <a href="/courses/gbif/dataciting/">Citing GBIF Data</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#initial-data-handling">Initial Data Handling</a>
      <ul>
        <li><a href="#common-data-considerations--issues">Common Data Considerations &amp; Issues</a></li>
        <li><a href="#extract-a-subset-of-cata-columns">Extract a Subset of Cata-Columns</a></li>
      </ul>
    </li>
    <li><a href="#explore-the-occurrence-data">Explore the Occurrence Data</a>
      <ul>
        <li><a href="#data-contents">Data Contents</a></li>
        <li><a href="#spatial-data-handling">Spatial Data Handling</a></li>
      </ul>
    </li>
    <li><a href="#session-info">Session Info</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>Handling Data with rgbif</h1>

          <div class="article-style">
            <div class="alert alert-normal">
  <div>
    <details>
  <summary>Preamble, Package-Loading, and GBIF API Credential Registering (click here):</summary>
<pre><code class="language-r">## Custom install &amp; load function
install.load.package &lt;- function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, repos = &quot;http://cran.us.r-project.org&quot;)
  }
  require(x, character.only = TRUE)
}
## names of packages we want installed (if not installed yet) and loaded
package_vec &lt;- c(
  &quot;rgbif&quot;,
  &quot;knitr&quot;, # for rmarkdown table visualisations
  &quot;sp&quot;, # for spatialobject creation
  &quot;sf&quot;, # an alternative spatial object library
  &quot;ggplot2&quot;, # for visualistion
  &quot;raster&quot;, # for setting and reading CRS
  &quot;rnaturalearth&quot; # for shapefiles of naturalearth
)
## executing install &amp; load for each package
sapply(package_vec, install.load.package)
</code></pre>
<pre><code>##         rgbif         knitr            sp            sf       ggplot2        raster 
##          TRUE          TRUE          TRUE          TRUE          TRUE          TRUE 
## rnaturalearth 
##          TRUE
</code></pre>
<pre><code class="language-r">options(gbif_user = &quot;my gbif username&quot;)
options(gbif_email = &quot;my registred gbif e-mail&quot;)
options(gbif_pwd = &quot;my gbif password&quot;)
</code></pre>
</details> 
  </div>
</div>
<p>First, we obtain and load the data we are interested in like such:</p>
<pre><code class="language-r"># Download query
res &lt;- occ_download(
  pred(&quot;taxonKey&quot;, sp_key),
  pred_in(&quot;basisOfRecord&quot;, c(&quot;HUMAN_OBSERVATION&quot;)),
  pred(&quot;country&quot;, &quot;NO&quot;),
  pred(&quot;hasCoordinate&quot;, TRUE),
  pred_gte(&quot;year&quot;, 2000),
  pred_lte(&quot;year&quot;, 2020)
)
# Downloading and Loading
res_meta &lt;- occ_download_wait(res, status_ping = 5, curlopts = list(), quiet = FALSE)
res_get &lt;- occ_download_get(res)
res_data &lt;- occ_download_import(res_get)
</code></pre>
<p>With this data in our <code>R</code> environment, we are ready to explore the data itself.</p>
<div class="alert alert-info">
  <div>
    There are <strong>a myriad</strong> of things you can do to and with GBIF mediated data - here, we focus only on a few data handling steps.
  </div>
</div>
<h2 id="initial-data-handling">Initial Data Handling</h2>
<p>Before working with the data you obtained via GBIF, it is usually good practice to first check that all data is as expected/in order and then either reduce the dataset further to fit quality standards and extract the relevant variables for your application.</p>
<h3 id="common-data-considerations--issues">Common Data Considerations &amp; Issues</h3>
<p>Common data considerations and quality flags are largely related to geolocations (but other quality markers do exist). These can be used as limiting factors in data discovery, when querying downloads as well as after a download is done and the data is loaded. Within the GBIF Portal, these options are presented in a side-bar like this:</p>
<p><img src="/courses/gbif/qualityflags.png" width="100%"/></a></p>
<p>As a matter of fact, we have already used the functionality by which to control for data quality markers when carrying out data discovery (<code>occ_search(...)</code>) and data download queries (<code>occ_download(...)</code>) by matching Darwin Core Terms like basisOfRecord or hasCoordinate.</p>
<p>For this exercise, let&rsquo;s focus on some data markers that are contained in our already downloaded data set which we may want to use for further limiting of our data set for subsequent analyses. To do so, let&rsquo;s consider the <code>coordinateUncertaintyInMeters</code> field by visualising the values we have obtained for each record in our occurrence data:</p>
<pre><code class="language-r">ggplot(res_data, aes(x = coordinateUncertaintyInMeters)) +
  geom_histogram(bins = 1e2) +
  theme_bw() +
  scale_y_continuous(trans = &quot;log10&quot;)
</code></pre>
<p><img src="rgbif-datacontrol_files/figure-html/uncertaintyinmetre-1.png" width="1440" /></p>
<p><strong>Note:</strong> The y-axis on the above plot is log-transformed and 439 of the underlying records do not report a value for <code>coordinateUncertaintyInMeters</code> thus being removed from the above visualisation.</p>
<p>What we find is that there exists considerable variation in confidence of individual occurrence locations and we probably want to remove those records which are assigned a certain level of <code>coordinateUncertaintyInMeters</code>. Let&rsquo;s say 200 metres (after all, we are dealing with a mobile organism):</p>
<pre><code class="language-r">preci_data &lt;- res_data[which(res_data$coordinateUncertaintyInMeters &lt; 200), ]
</code></pre>
<p>This quality control leaves us with 2721 <em>Lagopus muta</em> records. A significant drop in data points which may well change our analyses and their outcomes drastically.</p>
<h3 id="extract-a-subset-of-cata-columns">Extract a Subset of Cata-Columns</h3>
<p>GBIF mediated data comes with a lot of attributes. These can be assessed readily via the Darwin Core or, within <code>R</code> via: <code>colnames(...)</code> (here with <code>...</code>  = <code>res_data</code>). Rarely will we need all of them for our analyses. For now, we will simply subset the data for a smaller set of columns which are often relevant for end-users:</p>
<pre><code class="language-r">data_subset &lt;- preci_data[
  ,
  c(&quot;scientificName&quot;, &quot;decimalLongitude&quot;, &quot;decimalLatitude&quot;, &quot;basisOfRecord&quot;, &quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;eventDate&quot;, &quot;countryCode&quot;, &quot;municipality&quot;, &quot;stateProvince&quot;, &quot;taxonKey&quot;, &quot;species&quot;, &quot;catalogNumber&quot;, &quot;hasGeospatialIssues&quot;, &quot;hasCoordinate&quot;, &quot;mediaType&quot;, &quot;datasetKey&quot;)
]
knitr::kable(head(data_subset))
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">scientificName</th>
<th style="text-align:right">decimalLongitude</th>
<th style="text-align:right">decimalLatitude</th>
<th style="text-align:left">basisOfRecord</th>
<th style="text-align:right">year</th>
<th style="text-align:right">month</th>
<th style="text-align:right">day</th>
<th style="text-align:left">eventDate</th>
<th style="text-align:left">countryCode</th>
<th style="text-align:left">municipality</th>
<th style="text-align:left">stateProvince</th>
<th style="text-align:right">taxonKey</th>
<th style="text-align:left">species</th>
<th style="text-align:left">catalogNumber</th>
<th style="text-align:left">hasGeospatialIssues</th>
<th style="text-align:left">hasCoordinate</th>
<th style="text-align:left">mediaType</th>
<th style="text-align:left">datasetKey</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Lagopus muta (Montin, 1781)</td>
<td style="text-align:right">7.679194</td>
<td style="text-align:right">59.81584</td>
<td style="text-align:left">HUMAN_OBSERVATION</td>
<td style="text-align:right">2008</td>
<td style="text-align:right">5</td>
<td style="text-align:right">3</td>
<td style="text-align:left">2008-05-03</td>
<td style="text-align:left">NO</td>
<td style="text-align:left">Vinje</td>
<td style="text-align:left">Telemark</td>
<td style="text-align:right">5227679</td>
<td style="text-align:left">Lagopus muta</td>
<td style="text-align:left">34904134</td>
<td style="text-align:left">FALSE</td>
<td style="text-align:left">TRUE</td>
<td style="text-align:left"></td>
<td style="text-align:left">b124e1e0-4755-430f-9eab-894f25a9b59c</td>
</tr>
<tr>
<td style="text-align:left">Lagopus muta (Montin, 1781)</td>
<td style="text-align:right">28.961315</td>
<td style="text-align:right">70.46989</td>
<td style="text-align:left">HUMAN_OBSERVATION</td>
<td style="text-align:right">2017</td>
<td style="text-align:right">6</td>
<td style="text-align:right">5</td>
<td style="text-align:left">2017-06-05</td>
<td style="text-align:left">NO</td>
<td style="text-align:left"></td>
<td style="text-align:left">Finnmark</td>
<td style="text-align:right">5227679</td>
<td style="text-align:left">Lagopus muta</td>
<td style="text-align:left"></td>
<td style="text-align:left">FALSE</td>
<td style="text-align:left">TRUE</td>
<td style="text-align:left"></td>
<td style="text-align:left">8a863029-f435-446a-821e-275f4f641165</td>
</tr>
<tr>
<td style="text-align:left">Lagopus muta (Montin, 1781)</td>
<td style="text-align:right">23.689751</td>
<td style="text-align:right">70.68865</td>
<td style="text-align:left">HUMAN_OBSERVATION</td>
<td style="text-align:right">2015</td>
<td style="text-align:right">6</td>
<td style="text-align:right">22</td>
<td style="text-align:left">2015-06-22</td>
<td style="text-align:left">NO</td>
<td style="text-align:left"></td>
<td style="text-align:left">Finnmark</td>
<td style="text-align:right">5227679</td>
<td style="text-align:left">Lagopus muta</td>
<td style="text-align:left"></td>
<td style="text-align:left">FALSE</td>
<td style="text-align:left">TRUE</td>
<td style="text-align:left">StillImage</td>
<td style="text-align:left">8a863029-f435-446a-821e-275f4f641165</td>
</tr>
<tr>
<td style="text-align:left">Lagopus muta (Montin, 1781)</td>
<td style="text-align:right">8.628497</td>
<td style="text-align:right">60.65505</td>
<td style="text-align:left">HUMAN_OBSERVATION</td>
<td style="text-align:right">2000</td>
<td style="text-align:right">6</td>
<td style="text-align:right">5</td>
<td style="text-align:left">2000-06-05</td>
<td style="text-align:left">NO</td>
<td style="text-align:left"></td>
<td style="text-align:left">Buskerud</td>
<td style="text-align:right">5227679</td>
<td style="text-align:left">Lagopus muta</td>
<td style="text-align:left"></td>
<td style="text-align:left">FALSE</td>
<td style="text-align:left">TRUE</td>
<td style="text-align:left">StillImage</td>
<td style="text-align:left">8a863029-f435-446a-821e-275f4f641165</td>
</tr>
<tr>
<td style="text-align:left">Lagopus muta (Montin, 1781)</td>
<td style="text-align:right">24.720209</td>
<td style="text-align:right">71.10924</td>
<td style="text-align:left">HUMAN_OBSERVATION</td>
<td style="text-align:right">2019</td>
<td style="text-align:right">7</td>
<td style="text-align:right">18</td>
<td style="text-align:left">2019-07-18T10:41</td>
<td style="text-align:left">NO</td>
<td style="text-align:left"></td>
<td style="text-align:left">Finnmark</td>
<td style="text-align:right">5227679</td>
<td style="text-align:left">Lagopus muta</td>
<td style="text-align:left">214152489</td>
<td style="text-align:left">FALSE</td>
<td style="text-align:left">TRUE</td>
<td style="text-align:left">StillImage</td>
<td style="text-align:left">50c9509d-22c7-4a22-a47d-8c48425ef4a7</td>
</tr>
<tr>
<td style="text-align:left">Lagopus muta (Montin, 1781)</td>
<td style="text-align:right">24.729996</td>
<td style="text-align:right">71.11087</td>
<td style="text-align:left">HUMAN_OBSERVATION</td>
<td style="text-align:right">2017</td>
<td style="text-align:right">7</td>
<td style="text-align:right">14</td>
<td style="text-align:left">2017-07-14T10:26</td>
<td style="text-align:left">NO</td>
<td style="text-align:left"></td>
<td style="text-align:left">Finnmark</td>
<td style="text-align:right">5227679</td>
<td style="text-align:left">Lagopus muta</td>
<td style="text-align:left">214152361</td>
<td style="text-align:left">FALSE</td>
<td style="text-align:left">TRUE</td>
<td style="text-align:left">StillImage</td>
<td style="text-align:left">50c9509d-22c7-4a22-a47d-8c48425ef4a7</td>
</tr>
</tbody>
</table>
<h2 id="explore-the-occurrence-data">Explore the Occurrence Data</h2>
<p>Now that we have the data we might use for analyses ready, we can explore what the data itself contains.</p>
<h3 id="data-contents">Data Contents</h3>
<p>Here are a few overviews of <em>Lagopus muta</em> abundances across different data attributes:</p>
<pre><code class="language-r">table(data_subset$year)
</code></pre>
<pre><code>## 
## 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 
##    4    4   12    6    7   23    7   17   34   59   87  119  291  144  147  181  254  255 
## 2018 2019 2020 
##  372  382  316
</code></pre>
<pre><code class="language-r">table(data_subset$stateProvince)
</code></pre>
<pre><code>## 
##                                     Agder           Aust-Agder             Buskerud 
##                  149                  116                    2                   15 
##             Finnmark              Hedmark            Hordaland            Innlandet 
##                  127                  284                  269                  122 
##      Møre og Romsdal                 Nord       Nord-Trøndelag             Nordland 
##                   70                    8                  160                  309 
##              Oppland             Rogaland     Sogn og Fjordane                  Sør 
##                   77                   36                    3                    8 
##        Sør-Trøndelag             Telemark                Troms    Troms og Finnmark 
##                  150                    2                   40                  128 
##            Trøndelag           Vest-Agder Vestfold og Telemark             Vestland 
##                  405                   36                   25                  134 
##                Viken              Østfold 
##                   45                    1
</code></pre>
<pre><code class="language-r">table(data_subset$mediaType)
</code></pre>
<pre><code>## 
##            StillImage 
##       2606        115
</code></pre>
<h3 id="spatial-data-handling">Spatial Data Handling</h3>
<p>Most use-cases of GBIF make use of the geolocation references for data records either implicitly or explicitly. It is thus vital to be able to handle GBIF mediated data for spatial analyses. There exist plenty workshop (like 
<a href="https://pjbartlein.github.io/REarthSysSci/geospatial.html" target="_blank" rel="noopener">this one</a>) already for this topic so I will be brief.</p>
<h4 id="make-spatialpointsdataframe">Make <code>SpatialPointsDataFrame</code></h4>
<p>First, we can use the <code>sf</code> package to create <code>SpatialPoints</code> from our geo-referenced occurrence data:</p>
<pre><code class="language-r">options(digits = 8) ## set 8 digits (ie. all digits, not decimals) for the type cast as.double to keep decimals
data_subset &lt;- as.data.frame(data_subset)
data_subset$lon &lt;- as.double(data_subset$decimalLongitude) ## cast lon from char to double
data_subset$lat &lt;- as.double(data_subset$decimalLatitude) ## cast lat from char to double
data_sf &lt;- st_as_sf(data_subset, coords = c(&quot;lon&quot;, &quot;lat&quot;), remove = FALSE)
st_crs(data_sf) &lt;- CRS(&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0&quot;)
</code></pre>
<p>This data format lends itself well for analysing where occurrence have been recorded in relation to study parameters of choice (e.g., climatic conditions, land-use, political boundaries, etc.).</p>
<h4 id="spatialpoints-and-polygons"><code>SpatialPoints</code> and Polygons</h4>
<p>In first instance, <code>SpatialPoints</code> can easily be used to create initial visualisations of spatial patterns:</p>
<pre><code class="language-r">## get background map
NO_shp &lt;- rnaturalearth::ne_countries(country = &quot;Norway&quot;, scale = &quot;medium&quot;, returnclass = &quot;sf&quot;)[, 1]
## make plot
ggplot() +
  geom_sf(data = NO_shp) +
  geom_sf(data = data_sf[, 1]) +
  theme_bw() +
  labs(title = &quot;Occurrences of Lagopus muta recorded by human observations between 2000 and 2022&quot;)
</code></pre>
<p><img src="rgbif-datacontrol_files/figure-html/unnamed-chunk-6-1.png" width="1440" /></p>
<h4 id="the-coordinate-reference-system-crs">The Coordinate Reference System (CRS)</h4>
<p>Each spatial object in <code>R</code> is assigned a  
<a href="https://www.earthdatascience.org/courses/earth-analytics/spatial-data-r/intro-to-coordinate-reference-systems/" target="_blank" rel="noopener">Coordinate Reference System (CRS)</a> which details how geolocational values are to be understood. For an overview of different CRSs, see 
<a href="https://epsg.io/" target="_blank" rel="noopener">here</a>.</p>
<p>In <code>R</code>, we can assess the CRS of most spatial objects as follows:</p>
<pre><code class="language-r">st_crs(data_sf)
</code></pre>
<pre><code>## Coordinate Reference System:
##   User input: BOUNDCRS[
##     SOURCECRS[
##         GEOGCRS[&quot;unknown&quot;,
##             DATUM[&quot;World Geodetic System 1984&quot;,
##                 ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                     LENGTHUNIT[&quot;metre&quot;,1]],
##                 ID[&quot;EPSG&quot;,6326]],
##             PRIMEM[&quot;Greenwich&quot;,0,
##                 ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##                 ID[&quot;EPSG&quot;,8901]],
##             CS[ellipsoidal,2],
##                 AXIS[&quot;longitude&quot;,east,
##                     ORDER[1],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                         ID[&quot;EPSG&quot;,9122]]],
##                 AXIS[&quot;latitude&quot;,north,
##                     ORDER[2],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                         ID[&quot;EPSG&quot;,9122]]]]],
##     TARGETCRS[
##         GEOGCRS[&quot;WGS 84&quot;,
##             DATUM[&quot;World Geodetic System 1984&quot;,
##                 ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                     LENGTHUNIT[&quot;metre&quot;,1]]],
##             PRIMEM[&quot;Greenwich&quot;,0,
##                 ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##             CS[ellipsoidal,2],
##                 AXIS[&quot;latitude&quot;,north,
##                     ORDER[1],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##                 AXIS[&quot;longitude&quot;,east,
##                     ORDER[2],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##             ID[&quot;EPSG&quot;,4326]]],
##     ABRIDGEDTRANSFORMATION[&quot;Transformation from unknown to WGS84&quot;,
##         METHOD[&quot;Geocentric translations (geog2D domain)&quot;,
##             ID[&quot;EPSG&quot;,9603]],
##         PARAMETER[&quot;X-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8605]],
##         PARAMETER[&quot;Y-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8606]],
##         PARAMETER[&quot;Z-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8607]]]] 
##   wkt:
## BOUNDCRS[
##     SOURCECRS[
##         GEOGCRS[&quot;unknown&quot;,
##             DATUM[&quot;World Geodetic System 1984&quot;,
##                 ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                     LENGTHUNIT[&quot;metre&quot;,1]],
##                 ID[&quot;EPSG&quot;,6326]],
##             PRIMEM[&quot;Greenwich&quot;,0,
##                 ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##                 ID[&quot;EPSG&quot;,8901]],
##             CS[ellipsoidal,2],
##                 AXIS[&quot;longitude&quot;,east,
##                     ORDER[1],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                         ID[&quot;EPSG&quot;,9122]]],
##                 AXIS[&quot;latitude&quot;,north,
##                     ORDER[2],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                         ID[&quot;EPSG&quot;,9122]]]]],
##     TARGETCRS[
##         GEOGCRS[&quot;WGS 84&quot;,
##             DATUM[&quot;World Geodetic System 1984&quot;,
##                 ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                     LENGTHUNIT[&quot;metre&quot;,1]]],
##             PRIMEM[&quot;Greenwich&quot;,0,
##                 ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##             CS[ellipsoidal,2],
##                 AXIS[&quot;geodetic latitude (Lat)&quot;,north,
##                     ORDER[1],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##                 AXIS[&quot;geodetic longitude (Lon)&quot;,east,
##                     ORDER[2],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##             ID[&quot;EPSG&quot;,4326]]],
##     ABRIDGEDTRANSFORMATION[&quot;Transformation from unknown to WGS84&quot;,
##         METHOD[&quot;Geocentric translations (geog2D domain)&quot;,
##             ID[&quot;EPSG&quot;,9603]],
##         PARAMETER[&quot;X-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8605]],
##         PARAMETER[&quot;Y-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8606]],
##         PARAMETER[&quot;Z-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8607]]]]
</code></pre>
<pre><code class="language-r">st_crs(NO_shp)
</code></pre>
<pre><code>## Coordinate Reference System:
##   User input: WGS 84 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     ID[&quot;EPSG&quot;,4326]]
</code></pre>
<p>When dealing with data in specific areas of the world or wanting to match occurrence data to other products with specific CRSs, it may be prudent to reproject the <code>SpatialPoints</code> occurrence data object.  We can use <code>sf::st_transform)</code> to do so (this is reprojecting to the same CRS the data is already in):</p>
<pre><code class="language-r">sf::st_transform(data_sf, CRS(&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0&quot;))
</code></pre>
<pre><code>## Simple feature collection with 2721 features and 20 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 5.488913 ymin: 58.065259 xmax: 31.020815 ymax: 71.170652
## Geodetic CRS:  BOUNDCRS[
##     SOURCECRS[
##         GEOGCRS[&quot;unknown&quot;,
##             DATUM[&quot;World Geodetic System 1984&quot;,
##                 ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                     LENGTHUNIT[&quot;metre&quot;,1]],
##                 ID[&quot;EPSG&quot;,6326]],
##             PRIMEM[&quot;Greenwich&quot;,0,
##                 ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##                 ID[&quot;EPSG&quot;,8901]],
##             CS[ellipsoidal,2],
##                 AXIS[&quot;longitude&quot;,east,
##                     ORDER[1],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                         ID[&quot;EPSG&quot;,9122]]],
##                 AXIS[&quot;latitude&quot;,north,
##                     ORDER[2],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
##                         ID[&quot;EPSG&quot;,9122]]]]],
##     TARGETCRS[
##         GEOGCRS[&quot;WGS 84&quot;,
##             DATUM[&quot;World Geodetic System 1984&quot;,
##                 ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                     LENGTHUNIT[&quot;metre&quot;,1]]],
##             PRIMEM[&quot;Greenwich&quot;,0,
##                 ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##             CS[ellipsoidal,2],
##                 AXIS[&quot;latitude&quot;,north,
##                     ORDER[1],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##                 AXIS[&quot;longitude&quot;,east,
##                     ORDER[2],
##                     ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##             ID[&quot;EPSG&quot;,4326]]],
##     ABRIDGEDTRANSFORMATION[&quot;Transformation from unknown to WGS84&quot;,
##         METHOD[&quot;Geocentric translations (geog2D domain)&quot;,
##             ID[&quot;EPSG&quot;,9603]],
##         PARAMETER[&quot;X-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8605]],
##         PARAMETER[&quot;Y-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8606]],
##         PARAMETER[&quot;Z-axis translation&quot;,0,
##             ID[&quot;EPSG&quot;,8607]]]]
## First 10 features:
##                 scientificName decimalLongitude decimalLatitude     basisOfRecord year
## 1  Lagopus muta (Montin, 1781)         7.679194       59.815843 HUMAN_OBSERVATION 2008
## 2  Lagopus muta (Montin, 1781)        28.961315       70.469890 HUMAN_OBSERVATION 2017
## 3  Lagopus muta (Montin, 1781)        23.689751       70.688646 HUMAN_OBSERVATION 2015
## 4  Lagopus muta (Montin, 1781)         8.628497       60.655046 HUMAN_OBSERVATION 2000
## 5  Lagopus muta (Montin, 1781)        24.720209       71.109243 HUMAN_OBSERVATION 2019
## 6  Lagopus muta (Montin, 1781)        24.729996       71.110875 HUMAN_OBSERVATION 2017
## 7  Lagopus muta (Montin, 1781)        14.563245       67.088208 HUMAN_OBSERVATION 2017
## 8  Lagopus muta (Montin, 1781)         9.291491       62.433117 HUMAN_OBSERVATION 2020
## 9  Lagopus muta (Montin, 1781)         9.466869       62.722573 HUMAN_OBSERVATION 2004
## 10 Lagopus muta (Montin, 1781)        11.736154       62.914320 HUMAN_OBSERVATION 2002
##    month day        eventDate countryCode municipality stateProvince taxonKey
## 1      5   3       2008-05-03          NO        Vinje      Telemark  5227679
## 2      6   5       2017-06-05          NO                   Finnmark  5227679
## 3      6  22       2015-06-22          NO                   Finnmark  5227679
## 4      6   5       2000-06-05          NO                   Buskerud  5227679
## 5      7  18 2019-07-18T10:41          NO                   Finnmark  5227679
## 6      7  14 2017-07-14T10:26          NO                   Finnmark  5227679
## 7      6  17       2017-06-17          NO       Beiarn      Nordland  5227679
## 8      7  31       2020-07-31          NO       Oppdal    Trøndelag  5227679
## 9      9  11       2004-09-11          NO       Oppdal    Trøndelag  5227679
## 10     7  27       2002-07-27          NO                 Trøndelag  5227679
##         species  catalogNumber hasGeospatialIssues hasCoordinate  mediaType
## 1  Lagopus muta       34904134               FALSE          TRUE           
## 2  Lagopus muta                              FALSE          TRUE           
## 3  Lagopus muta                              FALSE          TRUE StillImage
## 4  Lagopus muta                              FALSE          TRUE StillImage
## 5  Lagopus muta      214152489               FALSE          TRUE StillImage
## 6  Lagopus muta      214152361               FALSE          TRUE StillImage
## 7  Lagopus muta       34314978               FALSE          TRUE           
## 8  Lagopus muta       33833573               FALSE          TRUE StillImage
## 9  Lagopus muta       32243615               FALSE          TRUE           
## 10 Lagopus muta BA00022793-106               FALSE          TRUE           
##                              datasetKey       lon       lat                    geometry
## 1  b124e1e0-4755-430f-9eab-894f25a9b59c  7.679194 59.815843  POINT (7.679194 59.815843)
## 2  8a863029-f435-446a-821e-275f4f641165 28.961315 70.469890  POINT (28.961315 70.46989)
## 3  8a863029-f435-446a-821e-275f4f641165 23.689751 70.688646 POINT (23.689751 70.688646)
## 4  8a863029-f435-446a-821e-275f4f641165  8.628497 60.655046  POINT (8.628497 60.655046)
## 5  50c9509d-22c7-4a22-a47d-8c48425ef4a7 24.720209 71.109243 POINT (24.720209 71.109243)
## 6  50c9509d-22c7-4a22-a47d-8c48425ef4a7 24.729996 71.110875 POINT (24.729996 71.110875)
## 7  b124e1e0-4755-430f-9eab-894f25a9b59c 14.563245 67.088208 POINT (14.563245 67.088208)
## 8  b124e1e0-4755-430f-9eab-894f25a9b59c  9.291491 62.433117  POINT (9.291491 62.433117)
## 9  b124e1e0-4755-430f-9eab-894f25a9b59c  9.466869 62.722573  POINT (9.466869 62.722573)
## 10 492d63a8-4978-4bc7-acd8-7d0e3ac0e744 11.736154 62.914320  POINT (11.736154 62.91432)
</code></pre>
<h4 id="classifying-spatial-data">Classifying Spatial Data</h4>
<p>Let&rsquo;s say, for example, we want to quantify abundances of <em>Lagopus muta</em> across political regions in Norway:</p>
<pre><code class="language-r">## Obtain sf object
NO_municip &lt;- rnaturalearth::ne_states(country = &quot;Norway&quot;, returnclass = &quot;sf&quot;) # get shapefiles for Norwegian states
NO_municip &lt;- sf::st_crop(NO_municip, extent(4.5, 31.5, 50, 71.5)) # crop shapefile to continental Norway
## Identify overlap of points and polygons
cover_sf &lt;- st_intersects(NO_municip, data_sf)
names(cover_sf) &lt;- NO_municip$name
## report abundances
abundances_municip &lt;- unlist(lapply(cover_sf, length))
knitr::kable(t(sort(abundances_municip, decreasing = TRUE)))
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:right">Sør-Trøndelag</th>
<th style="text-align:right">Hordaland</th>
<th style="text-align:right">Hedmark</th>
<th style="text-align:right">Nord-Trøndelag</th>
<th style="text-align:right">Nordland</th>
<th style="text-align:right">Oppland</th>
<th style="text-align:right">Finnmark</th>
<th style="text-align:right">Troms</th>
<th style="text-align:right">Vest-Agder</th>
<th style="text-align:right">Buskerud</th>
<th style="text-align:right">Møre og Romsdal</th>
<th style="text-align:right">Rogaland</th>
<th style="text-align:right">Telemark</th>
<th style="text-align:right">Sogn og Fjordane</th>
<th style="text-align:right">Aust-Agder</th>
<th style="text-align:right">Akershus</th>
<th style="text-align:right">Østfold</th>
<th style="text-align:right">Oslo</th>
<th style="text-align:right">Vestfold</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">489</td>
<td style="text-align:right">361</td>
<td style="text-align:right">348</td>
<td style="text-align:right">340</td>
<td style="text-align:right">286</td>
<td style="text-align:right">168</td>
<td style="text-align:right">160</td>
<td style="text-align:right">132</td>
<td style="text-align:right">122</td>
<td style="text-align:right">79</td>
<td style="text-align:right">78</td>
<td style="text-align:right">33</td>
<td style="text-align:right">28</td>
<td style="text-align:right">27</td>
<td style="text-align:right">25</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<p>Looks like there are hotspots for <em>Lagopus muta</em> in SørTrøndelag and Hordaland - could this be sampling bias or effects of bioclimatic niche preferences and local environmental conditions? Questions like these you will be able to answer with additional analyses which are beyond the scope of this workshop.</p>
<p>Let&rsquo;s visualise these abundances:</p>
<pre><code class="language-r">NO_municip$abundances &lt;- abundances_municip
ggplot(data = NO_municip) +
  geom_sf(aes(fill = abundances)) +
  scale_fill_viridis_c() +
  labs(x = &quot;Longitude&quot;, y = &quot;Latitude&quot;, col = &quot;Abundance&quot;)
</code></pre>
<p><img src="rgbif-datacontrol_files/figure-html/unnamed-chunk-10-1.png" width="1440" /></p>
<p>Finally, let&rsquo;s consider wanting to identify for each data record and attach to the data itself which state it falls into. We can do so as follows (not necessarily the most elegant way:</p>
<pre><code class="language-r">## create a dataframe of occurrence records by rownumber in original data (data_subset) and state-membership
cover_ls &lt;- lapply(names(cover_sf), FUN = function(x) {
  if (length(cover_sf[[x]]) == 0) {
    points &lt;- NA
  } else {
    points &lt;- cover_sf[[x]]
  }
  data.frame(
    municip = x,
    points = points
  )
})
cover_df &lt;- na.omit(do.call(rbind, cover_ls))
## attach state-membership to original data, NAs for points without state-membership
data_subset$municip &lt;- NA
data_subset$municip[cover_df$points] &lt;- cover_df$municip
## visualise the result
ggplot(data = NO_municip) +
  geom_sf(fill = &quot;white&quot;) +
  geom_point(
    data = data_subset, size = 1,
    aes(x = decimalLongitude, y = decimalLatitude, col = municip)
  ) +
  scale_colour_viridis_d() +
  labs(x = &quot;Longitude&quot;, y = &quot;Latitude&quot;, col = &quot;Municipality&quot;)
</code></pre>
<p><img src="rgbif-datacontrol_files/figure-html/unnamed-chunk-11-1.png" width="1440" /></p>
<p>Let&rsquo;s say we feed these data into an analysis which runs to completion and we want to report on our findings. What&rsquo;s next? Citing the data we used.</p>
<div class="alert alert-success">
  <div>
    Now that you can <strong>handle GBIF data locally</strong>, you are ready to pipe these data into your specific analysis tools. Lastly, you only need to cite the data you used.
  </div>
</div>
<h2 id="session-info">Session Info</h2>
<pre><code>## R version 4.4.0 (2024-04-24 ucrt)
## Platform: x86_64-w64-mingw32/x64
## Running under: Windows 11 x64 (build 22631)
## 
## Matrix products: default
## 
## 
## locale:
## [1] C
## 
## time zone: Europe/Oslo
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] rnaturalearth_1.0.1 raster_3.6-26       ggplot2_3.5.1       sf_1.0-17          
## [5] sp_2.1-4            knitr_1.48          rgbif_3.8.1        
## 
## loaded via a namespace (and not attached):
##  [1] gtable_0.3.6                  xfun_0.47                    
##  [3] bslib_0.8.0                   lattice_0.22-6               
##  [5] vctrs_0.6.5                   tools_4.4.0                  
##  [7] generics_0.1.3                curl_5.2.2                   
##  [9] tibble_3.2.1                  proxy_0.4-27                 
## [11] fansi_1.0.6                   highr_0.11                   
## [13] pkgconfig_2.0.3               R.oo_1.26.0                  
## [15] KernSmooth_2.23-22            data.table_1.16.0            
## [17] lifecycle_1.0.4               R.cache_0.16.0               
## [19] farver_2.1.2                  compiler_4.4.0               
## [21] stringr_1.5.1                 munsell_0.5.1                
## [23] terra_1.7-78                  codetools_0.2-20             
## [25] htmltools_0.5.8.1             class_7.3-22                 
## [27] sass_0.4.9                    yaml_2.3.10                  
## [29] lazyeval_0.2.2                pillar_1.9.0                 
## [31] jquerylib_0.1.4               whisker_0.4.1                
## [33] R.utils_2.12.3                classInt_0.4-10              
## [35] cachem_1.1.0                  wk_0.9.4                     
## [37] rnaturalearthdata_1.0.0       styler_1.10.3                
## [39] tidyselect_1.2.1              digest_0.6.37                
## [41] stringi_1.8.4                 dplyr_1.1.4                  
## [43] purrr_1.0.2                   bookdown_0.40                
## [45] labeling_0.4.3                fastmap_1.2.0                
## [47] grid_4.4.0                    colorspace_2.1-1             
## [49] cli_3.6.3                     magrittr_2.0.3               
## [51] triebeard_0.4.1               crul_1.5.0                   
## [53] utf8_1.2.4                    e1071_1.7-16                 
## [55] withr_3.0.1                   scales_1.3.0                 
## [57] bit64_4.0.5                   oai_0.4.0                    
## [59] rmarkdown_2.28                httr_1.4.7                   
## [61] bit_4.0.5                     blogdown_1.19                
## [63] rnaturalearthhires_1.0.0.9000 R.methodsS3_1.8.2            
## [65] evaluate_0.24.0               viridisLite_0.4.2            
## [67] s2_1.1.7                      urltools_1.7.3               
## [69] rlang_1.1.4                   Rcpp_1.0.13                  
## [71] httpcode_0.3.0                glue_1.7.0                   
## [73] DBI_1.2.3                     xml2_1.3.6                   
## [75] jsonlite_1.8.8                R6_2.5.1                     
## [77] plyr_1.8.9                    units_0.8-5
</code></pre>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/gbif/">GBIF</a>
  
  <a class="badge badge-light" href="/tag/biodiversity/">Biodiversity</a>
  
  <a class="badge badge-light" href="/tag/open-science/">Open Science</a>
  
</div>



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/gbif/datadownload/" rel="next">Downloading Data with rgbif</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/gbif/dataciting/" rel="prev">Citing GBIF Data</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on 2023-11-06</p>

          





          


          


  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/courses/gbif/nfdi-download/">Finding &amp; Downloading Data with rgbif</a></li>
      
      <li><a href="/courses/gbif/dataciting/">Citing GBIF Data</a></li>
      
      <li><a href="/courses/gbif/datadownload/">Downloading Data with rgbif</a></li>
      
      <li><a href="/courses/gbif/">Accessing, handling, and referencing open biodiversity data using the Global Biodiversity Information Facility (GBIF)</a></li>
      
      <li><a href="/courses/gbif/datadiscovery/">Discovering Data with rgbif</a></li>
      
    </ul>
  </div>
  



        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    © 2024
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/latex.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.66c553246b0f279a03be6e5597f72b52.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
