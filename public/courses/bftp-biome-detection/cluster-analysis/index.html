<!DOCTYPE html><html lang="en-gb" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Erik Kusch">

  
  
  
    
  
  <meta name="description" content="Preparing The Work Let&rsquo;s create our basic structure for this document:
Head Not much has changed in the head when compared to our last exercise. We merely change the contents and and the edit tag, since the rest stays the same for the entire project.">

  
  <link rel="alternate" hreflang="en-gb" href="https://www.erikkusch.com/courses/bftp-biome-detection/cluster-analysis/">

  


  
  
  
  <meta name="theme-color" content="#858383">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cutive+Mono%7CLora:400,700%7CRoboto:400,700&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-186216138-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-186216138-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu7658c99d512131214e4d6c003a3f85f7_112593_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu7658c99d512131214e4d6c003a3f85f7_112593_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://www.erikkusch.com/courses/bftp-biome-detection/cluster-analysis/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@ErikKusch">
  <meta property="twitter:creator" content="@ErikKusch">
  
  <meta property="og:site_name" content="Erik Kusch">
  <meta property="og:url" content="https://www.erikkusch.com/courses/bftp-biome-detection/cluster-analysis/">
  <meta property="og:title" content="Cluster Analysis | Erik Kusch">
  <meta property="og:description" content="Preparing The Work Let&rsquo;s create our basic structure for this document:
Head Not much has changed in the head when compared to our last exercise. We merely change the contents and and the edit tag, since the rest stays the same for the entire project."><meta property="og:image" content="https://www.erikkusch.com/img/%C3%A5motdalshytta.jpg">
  <meta property="twitter:image" content="https://www.erikkusch.com/img/%C3%A5motdalshytta.jpg"><meta property="og:locale" content="en-gb">
  
    
      <meta property="article:published_time" content="2020-06-10T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-06-10T00:00:00&#43;00:00">
  

  



  


  


  





  <title>Cluster Analysis | Erik Kusch</title>

</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  








  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/images/logo_huab2266ff59bbac6a094b6da1268adcf9_208479_0x70_resize_lanczos_2.png" alt="Erik Kusch"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/images/logo_huab2266ff59bbac6a094b6da1268adcf9_208479_0x70_resize_lanczos_2.png" alt="Erik Kusch"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-center" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Courses & Workshops</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/courses/krigr/"><span>KrigR - State-of-the-Art Climate Data within R</span></a>
            
              <a class="dropdown-item" href="/courses/gbif/"><span>Accessing and Referencing GBIF Data for Research</span></a>
            
              <a class="dropdown-item" href="/courses/rethinking/"><span>Statistical Rethinking - Introduction to Bayesian Statistics</span></a>
            
              <a class="dropdown-item" href="/courses/bayes-nets/"><span>Bayesian Networks - Causality through Bayesian Approaches</span></a>
            
              <a class="dropdown-item" href="/courses/biostat101/"><span>Biostats 101 - An Introduction to Biostatistics</span></a>
            
              <a class="dropdown-item" href="/courses/excursions-into-biostatistics/"><span>Biostats 301 - Excursions into Biostatistics</span></a>
            
              <a class="dropdown-item" href="/courses/bftp-biome-detection/"><span>BFTP - First Steps in Macroecology in R</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="https://htmlpreview.github.io/?https://github.com/ErikKusch/Homepage/blob/master/static/media/CV_ErikKusch.html" target="_blank" rel="noopener"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/bftp-biome-detection/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/bftp-biome-detection/data-allocation/">Exercises</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/bftp-biome-detection/data-allocation/">1 - Data Allocation</a>
      </li>
      
      <li class="active">
        <a href="/courses/bftp-biome-detection/cluster-analysis/">2 - Cluster Analysis</a>
      </li>
      
      <li >
        <a href="/courses/bftp-biome-detection/change-analysis/">3 - Change Analysis</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#preparing-the-work">Preparing The Work</a>
      <ul>
        <li><a href="#head">Head</a></li>
        <li><a href="#preamble">Preamble</a></li>
        <li><a href="#coding">Coding</a></li>
      </ul>
    </li>
    <li><a href="#cluster-analysis">Cluster Analysis</a>
      <ul>
        <li><a href="#loading-data">Loading Data</a></li>
        <li><a href="#data-extraction">Data Extraction</a></li>
        <li><a href="#data-prepartion">Data Prepartion</a></li>
        <li><a href="#cluster-identification">Cluster Identification</a></li>
      </ul>
    </li>
    <li><a href="#saving-workspace">Saving Workspace</a>
      <ul>
        <li><a href="#what-is-it-and-why-do-we-do-it">What Is It And Why Do We Do It?</a></li>
        <li><a href="#saving-and-loading-the-workspace">Saving And Loading The Workspace</a></li>
      </ul>
    </li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>Cluster Analysis</h1>

          <div class="article-style">
            <h2 id="preparing-the-work">Preparing The Work</h2>
<p>Let&rsquo;s create our basic structure for this document:</p>
<h3 id="head">Head</h3>
<p>Not much has changed in the <strong>head</strong> when compared to our last exercise. We merely change the <em>contents</em> and and the <em>edit</em> tag, since the rest stays the same for the entire project.</p>
<pre><code class="language-r"># ####################################################################### #
# PROJECT: [BFTP] Identifying Biomes And Their Shifts Using Remote Sensing
# CONTENTS: Functionality to identify clusters of NDVI mean and seasonality
# AUTHOR: Erik Kusch
# EDIT: 18/03/20
# ####################################################################### #
</code></pre>
<h3 id="preamble">Preamble</h3>
<p>I am keeping the same <strong>preamble</strong> as last time because we will need to index the data and the plot directory in this exercise. Our preamble then looks like this:</p>
<pre><code class="language-r">rm(list=ls()) # clearing the entire environment
Dir.Base &lt;- getwd() # identifying the current directory
Dir.Data &lt;- paste(Dir.Base, &quot;Data&quot;, sep=&quot;/&quot;) # generating the folder path for data folder
Dir.Plots &lt;- paste(Dir.Base, &quot;Plots&quot;, sep=&quot;/&quot;) # generating the folder path for figures folder
</code></pre>
<p>Notice, that we do not call the function <code>dir.create()</code> this time. We don&rsquo;t need to do so, because we already created the two directories established above in our last exercise. Usually, we would create this entire analysis of your BFTP project in one <code>R</code> code script. In this case, we would only have one preamble which defines and creates directories instead of doing this step for every single sub-part of the analysis. Alas, we want to break this down for you. Therefore, you see this preamble here and will again in the next exercise.</p>
<p>Again, this is where would load packages, but I am going to install and load the necessary packages when needed to show you what they are good for. Personally, I recommend you always load all necessary packages at the beginning of your code file and leave comments as to what you load them for. This will make it easier to remove packages you don&rsquo;t need anymore when you change things.</p>
<h3 id="coding">Coding</h3>
<p>Again, all of the important <strong>Coding</strong> happens after the head and the preamble are written and run in <code>R</code>. Basically, this is the rest of this document once more.</p>
<h2 id="cluster-analysis">Cluster Analysis</h2>
<p>Cluster analyses come in many forms. Here, we are interested in a k-means clustering approach. These approaches identify $k$ (a number) clusters. One of the most prominent ways to do this in <code>R</code> is undoubtedly the <code>mclust</code> <code>R</code> package. Clusters can be thought of as groupings of data in multi-dimensional space. The number of dimensions is equal to the number of clustering components. In the <code>mclust</code> <code>R</code> package, the characteristics of these clusters (orientation, volume, shape) are, if not specified otherwise, estimated from the data.</p>
<!-- They can be set to vary between clusters or constrained to be the same for all clusters. Depending on cluster characteristics, `mclust` distinguishes 20 individual models which you can see in table \ref{tab:MClustModels}, but are not expected to understand fully.   -->
<!-- \begin{table}[ht!] -->
<!--   \centering -->
<!--   \caption[Models in mclust]{\textbf{Models in mclust:} The r-package mclust distinguishes 20 different models for data clustering based on distribution and cluster characteristics.} -->
<!--     \begin{tabular}{|lcccc|} -->
<!--     Acronym & Distribution & Volume & Shape & Orientation \\ -->
<!--     \hline -->
<!--     E     & univariate & equal & -     & - \\ -->
<!--     V     & univariate & variable & -     & - \\ \hdashline -->
<!--     EII   & spherical  & equal & equal & NA \\ -->
<!--     VII   & spherical  & variable & equal & NA \\ \hdashline -->
<!--     EEI   & diagonal & equal & equal & coordinate axes \\ -->
<!--     VEI   & diagonal & variable & equal & coordinate axes \\ -->
<!--     EVI   & diagonal & equal & variable & coordinate axes \\ -->
<!--     VVI   & diagonal & variable & variable & coordinate axes \\ \hdashline -->
<!--     EEE   & ellipsoidal & equal & equal & equal \\ -->
<!--     EVE   & ellipsoidal & equal & variable & equal \\ -->
<!-- 	VEE   & ellipsoidal & variable & equal & equal \\     -->
<!--     VVE   & ellipsoidal & variable & variable & equal \\ -->
<!--     EEV   & ellipsoidal & equal & equal & variable \\ -->
<!--     VEV   & ellipsoidal & variable & equal & variable \\ -->
<!--     EEV   & ellipsoidal & equal & variable & variable \\ -->
<!--     VVV   & ellipsoidal & variable & variable & variable \\ \hdashline -->
<!--     X	  & \multicolumn{4}{c|}{univariate normal} \\ -->
<!--     XII	  & \multicolumn{4}{c|}{spherical multivariate normal} \\ -->
<!--     XXI	  & \multicolumn{4}{c|}{diagonal multivariate normal} \\ -->
<!--     XXX	  & \multicolumn{4}{c|}{ellipsoidal multivariate normal} \\ -->
<!--     \hline -->
<!--     \end{tabular}% -->
<!--   \label{tab:MClustModels}% -->
<!-- \end{table} -->
<p><code>mclust</code> provides the user with a very autonomous process of model calculation and selection. First, if not specified otherwise, <code>mclust</code> calculates all available models for a range of cluster component numbers (by default one to nine clusters). Secondly, once the models are established, <code>mclust</code> selects the most appropriate of the models according to their respective Bayesian Information Criterion (BIC) value. The BIC is an indicator of model quality: the lower the BIC, the better the model fits the data. Conclusively, <code>mclust</code> chooses the model with the lowest BIC available for clustering the data.</p>
<!-- As an example: for a clustering of data with four individual variables, `mclust` will, by default, calculate 126 individual models (14 model classes $*$ 9 cluster possibilities). It will calculate models from only 14 classes, since E, V, X, XII, XXI and XXX models are only appropriate for single variable clustering.   -->
<h3 id="loading-data">Loading Data</h3>
<p>Before we can get started with our analysis, we have to load our NDVI mean and seasonality data (see last exercise) back into <code>R</code>, we do this as follows:</p>
<pre><code class="language-r">library(raster) # the raster package for rasters
Mean1982_ras &lt;- raster(paste(Dir.Data, &quot;1982Mean.nc&quot;, sep=&quot;/&quot;)) # loading means
Season1982_ras &lt;- raster(paste(Dir.Data, &quot;1982Season.nc&quot;, sep=&quot;/&quot;)) # loading seasonalities
</code></pre>
<p>Now that we have loaded the data into <code>R</code>, it is time to introduce you to another useful feature of the <code>raster</code> package - the <strong>stack</strong>. With a stack of rasters, you can do exactly what the name suggests, stack rasters of the same resolution, and extent into one <code>R</code> object. You do this by calling the <code>stack()</code>function in <code>R</code>:</p>
<pre><code class="language-r">All1982_ras &lt;- stack(Mean1982_ras, Season1982_ras) # creating a stack
names(All1982_ras) &lt;- c(&quot;Mean&quot;, &quot;Seasonality&quot;) # assign names to stack layers
All1982_ras
</code></pre>
<pre><code>## class      : RasterStack 
## dimensions : 237, 590, 139830, 2  (nrow, ncol, ncell, nlayers)
## resolution : 0.083, 0.083  (x, y)
## extent     : -179, -130, 51, 71  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## names      : Mean, Seasonality 
## min values :    0,           0 
## max values : 0.84,        1.00
</code></pre>
<p>As you can see, this object contains both rasters as <em>layers</em> which we have already assigned names to.</p>
<p>Now let&rsquo;s see how plotting works with this. This time, I am adding a couple of arguments to the <code>plot()</code> function to make the plots nicer than before:</p>
<pre><code class="language-r">plot(All1982_ras, # what to plot
     colNA = &quot;black&quot;, # which colour to assign to NA values
     legend.shrink=1, # vertical size of legend
     legend.width=2 # horizontal size of legend
     )
</code></pre>
<p><img src="02---classifications_files/figure-html/Loading3-1.png" width="1152" /></p>
<p>Using stacks makes plotting easier in <code>R</code> if you want to plot more than one raster at a time.</p>
<h3 id="data-extraction">Data Extraction</h3>
<p>We&rsquo;re now ready to extract data from our data sets. <code>mclust</code> let&rsquo;s us assess multi-dimensional clusters but wants the data to be handed over in one file - as a matrix, to be precise. Let&rsquo;s see what happens when we just look the first few (<code>head()</code>) values (<code>values()</code>) of our raster stack:</p>
<pre><code class="language-r">head(values(All1982_ras))
</code></pre>
<pre><code>##      Mean Seasonality
## [1,]   NA          NA
## [2,]   NA          NA
## [3,]   NA          NA
## [4,]   NA          NA
## [5,]   NA          NA
## [6,]   NA          NA
</code></pre>
<p>As you can see, the data gets extracted but there are NA values here. This is because the top-left corner of our rasters (which is where values start) contains a lot of NA cells.</p>
<p>Let&rsquo;s see what kind of object this is:</p>
<pre><code class="language-r">class(values(All1982_ras))
</code></pre>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;
</code></pre>
<p>It is a matrix! Just what <code>mclust</code> wants! Let&rsquo;s actually create that as an object:</p>
<pre><code class="language-r">Vals1982_mat &lt;- values(All1982_ras)
rownames(Vals1982_mat) &lt;- 1:dim(Vals1982_mat)[1] # rownames to index raster cell number
</code></pre>
<p>Finally, let&rsquo;s carry out a sanity check to make sure that we really have ported all values from both source rasters to our matrix. For this to be the case, the rownumber of our matrix (<code>dim()[1]</code>) needs to be the same as the amount (<code>length()</code>) of values (<code>values()</code>) in our rasters:</p>
<pre><code class="language-r">dim(Vals1982_mat)[1] == length(values(Mean1982_ras)) &amp; 
  dim(Vals1982_mat)[1] == length(values(Season1982_ras))
</code></pre>
<pre><code>## [1] TRUE
</code></pre>
<p>This checks out!</p>
<h3 id="data-prepartion">Data Prepartion</h3>
<p>As you remember, there were plenty of NA values in our data set. No cluster algorithm can handle these. Therefore, we need to get rid of them. This is done as follows:</p>
<pre><code class="language-r">Vals1982_mat &lt;- na.omit(Vals1982_mat) # omit all rows which contain at least one NA record
dim(Vals1982_mat) # new dimensions of our matrix
</code></pre>
<pre><code>## [1] 39460     2
</code></pre>
<p>This seriously cut our data down and will speed up our clustering approach a lot.</p>
<h3 id="cluster-identification">Cluster Identification</h3>
<p>Let&rsquo;s install and load the <code>mclust</code> package.</p>
<pre><code class="language-r">install.packages(&quot;mclust&quot;)
library(mclust)
</code></pre>
<h4 id="cluster-model-selection">Cluster Model Selection</h4>
<p>Let&rsquo;s start with the <code>mclust</code> functionality to identify the best fitting clustering with a range of 1 to 9 clusters. To do so, we first need to identify the BIC fit for all of our possible cluster models. <code>mclust</code> does this automatically:</p>
<pre><code class="language-r">dataBIC &lt;- mclustBIC(Vals1982_mat) # identify BICs for different models
print(summary(dataBIC)) # show summary of top-ranking models
</code></pre>
<pre><code>## Best BIC values:
##           EVV,8    EVV,9  EVE,8
## BIC      136809 136800.2 135504
## BIC diff      0     -8.6  -1304
</code></pre>
<p>The output above tells us that the best performing model was of type EVV (ellipsoidal distribution,  equal volume, variable shape, and variable orientation of clusters) identifying 9 clusters.</p>
<p>Let&rsquo;s see a visual overview of this:</p>
<pre><code class="language-r">plot(dataBIC)
</code></pre>
<p><img src="02---classifications_files/figure-html/MClust1b-1.png" width="1152" />
Here, you can see different models compared to each other given certain numbers of clusters that have been considered.</p>
<p>Now we can build our model:</p>
<pre><code class="language-r">mod &lt;- Mclust(Vals1982_mat, # data for the cluster model
                   G = 7 # BIC index for model to be built
                   )
</code></pre>
<p>We now have our full model! How many clusters did it identify?</p>
<pre><code class="language-r">mod$G # number of groups/clusters in model
</code></pre>
<pre><code>## [1] 7
</code></pre>
<p>No surprises here, we&rsquo;ve got 7 clusters.</p>
<p>Now let&rsquo;s look at the mean values of the clusters:</p>
<pre><code class="language-r">mod[[&quot;parameters&quot;]][[&quot;mean&quot;]] # mean values of clusters
</code></pre>
<pre><code>##             [,1] [,2] [,3]  [,4] [,5] [,6] [,7]
## Mean        0.36 0.53 0.67 0.081 0.44 0.26 0.21
## Seasonality 0.76 0.56 0.35 0.269 0.72 0.64 0.59
</code></pre>
<p>These can be interpreted biologically, but I will leave that to you.</p>
<p>Now let&rsquo;s see how well these clusters distinguish the mean-seasonality space:</p>
<pre><code class="language-r">plot(mod, what = &quot;uncertainty&quot;)
</code></pre>
<p><img src="02---classifications_files/figure-html/MClust1f-1.png" width="1152" /></p>
<p>How do we map this? We <em>predict</em> our clusters for our initial data as follows:</p>
<pre><code class="language-r">ModPred &lt;- predict.Mclust(mod, Vals1982_mat) # prediction
Pred_ras &lt;- Mean1982_ras # establishing a rediction raster
values(Pred_ras) &lt;- NA # set everything to NA
# set values of prediction raster to corresponding classification according to rowname
values(Pred_ras)[as.numeric(rownames(Vals1982_mat))] &lt;- as.vector(ModPred$classification)
Pred_ras
</code></pre>
<pre><code>## class      : RasterLayer 
## dimensions : 237, 590, 139830  (nrow, ncol, ncell)
## resolution : 0.083, 0.083  (x, y)
## extent     : -179, -130, 51, 71  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 1, 7  (min, max)
</code></pre>
<p>As you can see, this has the same extent and resolution as our source rasters but the values range from 1 to 7. These are our cluster assignments.</p>
<p>Now let&rsquo;s plot this:</p>
<pre><code class="language-r">colours &lt;- rainbow(mod$G) # define 7 colours
plot(Pred_ras, # what to plot
     col = colours, # colours for groups
     colNA = &quot;black&quot;, # which colour to assign to NA values
     legend.shrink=1, # vertical size of legend
     legend.width=2 # horizontal size of legend
     )
</code></pre>
<p><img src="02---classifications_files/figure-html/MClust1h-1.png" width="1152" /></p>
<p>How often do we observe which assignment?</p>
<pre><code class="language-r">table(values(Pred_ras))
</code></pre>
<pre><code>## 
##     1     2     3     4     5     6     7 
## 13101  1902  1118  2939  5608  8047  6745
</code></pre>
<h4 id="pre-defined-number">Pre-Defined Number</h4>
<p>As biologists, we have got decades of work already present concerning biome distributions across the Earth. One such classification are the Terrestrial Ecoregions of the World (\url{https://www.worldwildlife.org/publications/terrestrial-ecoregions-of-the-world}). We want to identify how many biomes this data set identifies across Australia.</p>
<p>Firstly, we download the data and unpack it:</p>
<pre><code class="language-r"># downloading Terrestrial Ecoregion Shapefile as zip
download.file(&quot;http://assets.worldwildlife.org/publications/15/files/original/official_teow.zip&quot;,
              destfile = file.path(Dir.Data, &quot;wwf_ecoregions.zip&quot;)
              )
# unpacking the zip
unzip(file.path(Dir.Data, &quot;wwf_ecoregions.zip&quot;), 
      exdir = file.path(Dir.Data, &quot;WWF_ecoregions&quot;)
      )
</code></pre>
<p>Secondly, we load the data into <code>R</code>:</p>
<pre><code class="language-r"># loading shapefile for biomes
wwf &lt;- readOGR(file.path(Dir.Data, &quot;WWF_ecoregions&quot;, &quot;official&quot;, &quot;wwf_terr_ecos.shp&quot;),
               verbose = FALSE)
</code></pre>
<p>Thirdly, we need to limit the global terrestrial ecoregion shapefile to the state of Alaska and need our Alaska shapefile for this:</p>
<pre><code class="language-r">Shapes &lt;- readOGR(Dir.Data, # where to look for the file
                  &quot;ne_10m_admin_1_states_provinces&quot;, # the file name
                  verbose = FALSE) # we don't want an overview of the loaded data
Position &lt;- which(Shapes$name_en == &quot;Alaska&quot;) # find the english name that's &quot;Alaska&quot;
Alaska_Shp &lt;- Shapes[Position,] # extract the Alaska shapefile
Alaska_Shp &lt;- crop(Alaska_Shp, # what to crop
                   extent(-190, -130, 51, 71)) # which extent to crop to
</code></pre>
<p>Now, we need to limit the global biome shapefile to the shape of Alaska:</p>
<pre><code class="language-r">wwf_ready &lt;- crop(wwf, extent(Alaska_Shp)) # cropping to Alaska extent
wwf_ready &lt;- intersect(Alaska_Shp, wwf) # masking of two shapefiles
plot(wwf_ready,  # plotting final shape
     col = wwf_ready@data[[&quot;BIOME&quot;]] # use BIOME specification for colours
     )
</code></pre>
<p><img src="02---classifications_files/figure-html/MClust2c-1.png" width="1152" /></p>
<p>We first identify the BICs:</p>
<pre><code class="language-r"># identify BICs for different models
dataBIC2 &lt;- mclustBIC(Vals1982_mat, 
                     G = length(unique(wwf_ready@data[[&quot;G200_BIOME&quot;]]))) 
print(summary(dataBIC2)) # show summary of top-ranking models
</code></pre>
<pre><code>## Best BIC values:
##           EVV,4  VVE,4  EVE,4
## BIC      133035 132345 125463
## BIC diff      0   -690  -7572
</code></pre>
<p>As you can see, the shapefile gives us 4 clusters across Alaska even though the map only shows 3. The fourth biome is only represented by a single polygon across all of Alaska and we might want to reduce the set to 3.</p>
<p>For now, we are running with the idea of 4 clusters:</p>
<pre><code class="language-r">mod2 &lt;- Mclust(Vals1982_mat, # data for the cluster model
                   G = 4 # BIC index for model to be built
                   )
</code></pre>
<p>We now have our full model!</p>
<p>Now let&rsquo;s look at the mean values of the clusters:</p>
<pre><code class="language-r">mod2[[&quot;parameters&quot;]][[&quot;mean&quot;]] # mean values of clusters
</code></pre>
<pre><code>##             [,1] [,2] [,3] [,4]
## Mean        0.41 0.13 0.60 0.27
## Seasonality 0.73 0.39 0.44 0.67
</code></pre>
<p>Again, I leave the biological interpretation to you.</p>
<p>Finally, we will plot our assignments in mean-seasonality space:</p>
<pre><code class="language-r">plot(mod2, what = &quot;uncertainty&quot;)
</code></pre>
<p><img src="02---classifications_files/figure-html/MClust2h-1.png" width="1152" /></p>
<p>Again, let&rsquo;s <em>predict</em> our clusters for our initial data as follows:</p>
<pre><code class="language-r">ModPred2 &lt;- predict.Mclust(mod2, Vals1982_mat) # prediction
Pred2_ras &lt;- Mean1982_ras # establishing a rediction raster
values(Pred2_ras) &lt;- NA # set everything to NA
# set values of prediction raster to corresponding classification according to rowname
values(Pred2_ras)[as.numeric(rownames(Vals1982_mat))] &lt;- as.vector(ModPred2$classification)
Pred2_ras
</code></pre>
<pre><code>## class      : RasterLayer 
## dimensions : 237, 590, 139830  (nrow, ncol, ncell)
## resolution : 0.083, 0.083  (x, y)
## extent     : -179, -130, 51, 71  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 1, 4  (min, max)
</code></pre>
<p>As you can see, this has the same extent and resolution as our source rasters but the values range from 1 to 4. These are our cluster assignments.</p>
<p>Now let&rsquo;s plot this:</p>
<pre><code class="language-r">colours &lt;- rainbow(mod2$G) # define 4 colours
plot(Pred2_ras, # what to plot
     col = colours, # colours for groups
     colNA = &quot;black&quot;, # which colour to assign to NA values
     legend.shrink=1, # vertical size of legend
     legend.width=2 # horizontal size of legend
     )
</code></pre>
<p><img src="02---classifications_files/figure-html/MClust2j-1.png" width="1152" /></p>
<p>How often do we observe which assignment?</p>
<pre><code class="language-r">table(values(Pred2_ras))
</code></pre>
<pre><code>## 
##     1     2     3     4 
## 12223  4066  2327 20844
</code></pre>
<h2 id="saving-workspace">Saving Workspace</h2>
<h3 id="what-is-it-and-why-do-we-do-it">What Is It And Why Do We Do It?</h3>
<p>The workspace records all of our elements in <code>R</code>. Since we want to pick up from this point in our next exercise, we want to save the workspace and restore it at a later point to assess all of our elements again.</p>
<h3 id="saving-and-loading-the-workspace">Saving And Loading The Workspace</h3>
<p>Saving a workspace goes as follows:</p>
<pre><code class="language-r"># save workspace
save.image(file = (paste(Dir.Base, &quot;Workspace.RData&quot;, sep=&quot;/&quot;)))
</code></pre>
<p>Now let&rsquo;s load it again:</p>
<pre><code class="language-r">rm(list=ls()) # clean workspace
load(file = &quot;Workspace.RData&quot;) # load workspace
ls() # list elements in workspace
</code></pre>
<pre><code>##  [1] &quot;Alaska_Shp&quot;     &quot;All1982_ras&quot;    &quot;colours&quot;       
##  [4] &quot;dataBIC&quot;        &quot;dataBIC2&quot;       &quot;Dir.Base&quot;      
##  [7] &quot;Dir.Data&quot;       &quot;Dir.Plots&quot;      &quot;Mean1982_ras&quot;  
## [10] &quot;mod&quot;            &quot;mod2&quot;           &quot;ModPred&quot;       
## [13] &quot;ModPred2&quot;       &quot;Position&quot;       &quot;Pred_ras&quot;      
## [16] &quot;Pred2_ras&quot;      &quot;Season1982_ras&quot; &quot;Shapes&quot;        
## [19] &quot;Vals1982_mat&quot;   &quot;wwf&quot;            &quot;wwf_ready&quot;
</code></pre>
<p>All our files are back!</p>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/r/">R</a>
  
  <a class="badge badge-light" href="/tag/statistics/">Statistics</a>
  
  <a class="badge badge-light" href="/tag/remote-sensing/">Remote Sensing</a>
  
</div>



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/bftp-biome-detection/data-allocation/" rel="next"></a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/bftp-biome-detection/change-analysis/" rel="prev">Change Analysis</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on 2020-06-10</p>

          





          


          


  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/courses/bftp-biome-detection/data-allocation/"></a></li>
      
      <li><a href="/courses/bftp-biome-detection/change-analysis/">Change Analysis</a></li>
      
      <li><a href="/courses/excursions-into-biostatistics/classifications-order-from-chaos/">Classifications</a></li>
      
      <li><a href="/courses/excursions-into-biostatistics/data-handling-and-data-assumptions/">Data Handling and Data Assumptions</a></li>
      
      <li><a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection</a></li>
      
    </ul>
  </div>
  



        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    © 2024
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/latex.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.66c553246b0f279a03be6e5597f72b52.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
