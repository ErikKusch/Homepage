<!DOCTYPE html><html lang="en-gb" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Erik Kusch">

  
  
  
    
  
  <meta name="description" content="Preparing The Work First of all, most .R scripts will follow the same kind of structure:
Head The Head is used as an information statement at the top of your code document that informs the user of the contents, author, and (sometimes) date of the last edit on said document.">

  
  <link rel="alternate" hreflang="en-gb" href="https://www.erikkusch.com/courses/bftp-biome-detection/data-allocation/">

  


  
  
  
  <meta name="theme-color" content="#858383">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cutive+Mono%7CLora:400,700%7CRoboto:400,700&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-186216138-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-186216138-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu7658c99d512131214e4d6c003a3f85f7_112593_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu7658c99d512131214e4d6c003a3f85f7_112593_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://www.erikkusch.com/courses/bftp-biome-detection/data-allocation/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@ErikKusch">
  <meta property="twitter:creator" content="@ErikKusch">
  
  <meta property="og:site_name" content="Erik Kusch">
  <meta property="og:url" content="https://www.erikkusch.com/courses/bftp-biome-detection/data-allocation/">
  <meta property="og:title" content=" | Erik Kusch">
  <meta property="og:description" content="Preparing The Work First of all, most .R scripts will follow the same kind of structure:
Head The Head is used as an information statement at the top of your code document that informs the user of the contents, author, and (sometimes) date of the last edit on said document."><meta property="og:image" content="https://www.erikkusch.com/img/%C3%A5motdalshytta.jpg">
  <meta property="twitter:image" content="https://www.erikkusch.com/img/%C3%A5motdalshytta.jpg"><meta property="og:locale" content="en-gb">
  
    
      <meta property="article:published_time" content="2020-06-10T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-06-10T00:00:00&#43;00:00">
  

  



  


  


  





  <title> | Erik Kusch</title>

</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  








  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/images/logo_huab2266ff59bbac6a094b6da1268adcf9_208479_0x70_resize_lanczos_2.png" alt="Erik Kusch"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/images/logo_huab2266ff59bbac6a094b6da1268adcf9_208479_0x70_resize_lanczos_2.png" alt="Erik Kusch"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-center" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Courses & Workshops</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/courses/krigr/"><span>KrigR - State-of-the-Art Climate Data within R</span></a>
            
              <a class="dropdown-item" href="/courses/gbif/"><span>Accessing and Referencing GBIF Data for Research</span></a>
            
              <a class="dropdown-item" href="/courses/rethinking/"><span>Statistical Rethinking - Introduction to Bayesian Statistics</span></a>
            
              <a class="dropdown-item" href="/courses/bayes-nets/"><span>Bayesian Networks - Causality through Bayesian Approaches</span></a>
            
              <a class="dropdown-item" href="/courses/biostat101/"><span>Biostats 101 - An Introduction to Biostatistics</span></a>
            
              <a class="dropdown-item" href="/courses/excursions-into-biostatistics/"><span>Biostats 301 - Excursions into Biostatistics</span></a>
            
              <a class="dropdown-item" href="/courses/bftp-biome-detection/"><span>BFTP - First Steps in Macroecology in R</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="https://htmlpreview.github.io/?https://github.com/ErikKusch/Homepage/blob/master/static/media/CV_ErikKusch.html" target="_blank" rel="noopener"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/bftp-biome-detection/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/bftp-biome-detection/data-allocation/">Exercises</a>
    <ul class="nav docs-sidenav">
      
      <li class="active">
        <a href="/courses/bftp-biome-detection/data-allocation/">1 - Data Allocation</a>
      </li>
      
      <li >
        <a href="/courses/bftp-biome-detection/cluster-analysis/">2 - Cluster Analysis</a>
      </li>
      
      <li >
        <a href="/courses/bftp-biome-detection/change-analysis/">3 - Change Analysis</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#preparing-the-work">Preparing The Work</a>
      <ul>
        <li><a href="#head">Head</a></li>
        <li><a href="#preamble">Preamble</a></li>
        <li><a href="#coding">Coding</a></li>
      </ul>
    </li>
    <li><a href="#downloading-ndvi-data">Downloading NDVI Data</a>
      <ul>
        <li><a href="#packages">Packages</a></li>
        <li><a href="#downloading">Downloading</a></li>
      </ul>
    </li>
    <li><a href="#aggregating-ndvi-data">Aggregating NDVI Data</a>
      <ul>
        <li><a href="#composites">Composites</a></li>
        <li><a href="#annual-values">Annual Values</a></li>
      </ul>
    </li>
    <li><a href="#cropping-ndvi-data">Cropping NDVI Data</a>
      <ul>
        <li><a href="#packages--data">Packages &amp; Data</a></li>
        <li><a href="#crop--mask">Crop &amp; Mask</a></li>
      </ul>
    </li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1></h1>

          <div class="article-style">
            <h2 id="preparing-the-work">Preparing The Work</h2>
<p>First of all, most <code>.R</code> scripts will follow the same kind of structure:</p>
<h3 id="head">Head</h3>
<p>The <strong>Head</strong> is used as an information statement at the top of your code document that informs the user of the contents, author, and (sometimes) date of the last edit on said document. This is highly useful when you are intending to give your document to other people at some point. The head for our analysis might look something like this:</p>
<pre><code class="language-r"># ####################################################################### #
# PROJECT: [BFTP] Identifying Biomes And Their Shifts Using Remote Sensing
# CONTENTS: Functionality to download, aggregate, and crop/mask NDVI data
# AUTHOR: Erik Kusch
# EDIT: 09/03/20
# ####################################################################### #
</code></pre>
<h3 id="preamble">Preamble</h3>
<p>The <strong>Preamble</strong> is where you set up the most important parameters/guidelines for your coding script. Personally, I <em>highly</em> recommend to make your first line in the preamble read <code>rm(list=ls())</code>. This nifty line of code clears your entire working environment in <code>R</code> meaning that you work from a clean slate thus eliminating all possible interference of previous work. If your code works as intended after this line, it means that your project is <em>internally consistent</em> and <em>self-contained</em> which makes your analysis <strong>reproducible</strong> (we want that!).</p>
<p>Afterwards, I like to establish a <em>directory</em> (i.e. &ldquo;folder&rdquo;) structure. After all, no one likes a cluttered folder on their hard drive.Therefore, we identify our current working directory (wd) with <code>getwd()</code> and save it as an object in <code>R</code> which we call <code>Dir.Base</code>. This is the folder in which our document is located and where <code>R</code> is looking for and saving files to. We don&rsquo;t want to dump everything there. Conclusively, we need to create our own folders within our project folder. We would like to call these folders &ldquo;Data&rdquo; and &ldquo;Plots&rdquo; (the purpose of these folders should be obvious from their names). To actually create these folders on your hard drive, we must first establish the folder paths. We do so by using the <code>paste()</code> command in <code>R</code> which combines objects and writes the <code>sep</code> argument between the combined objects. Here, we take the path to our project folder (<code>Dir.Base </code>) and combine it with the name of the folder we want (e.g. &ldquo;Data&rdquo;) while using the backslash (&quot;/&quot;) between these two objects as it indicates the jump in a folder hierarchy. The folder is then created using the <code>dir.create()</code> function.</p>
<p>Our preamble then looks like this:</p>
<pre><code class="language-r">rm(list=ls()) # clearing the entire environment
Dir.Base &lt;- getwd() # identifying the current directory
Dir.Data &lt;- paste(Dir.Base, &quot;Data&quot;, sep=&quot;/&quot;) # generating the folder path for data folder
dir.create(Dir.Data) # creating the data folder
Dir.Plots &lt;- paste(Dir.Base, &quot;Plots&quot;, sep=&quot;/&quot;) # generating the folder path for figures folder
dir.create(Dir.Plots) # creating the figures folder
</code></pre>
<p>Usually, this is also where we load <em>packages</em> for more functionality of our analyses. However, this time, we will do so when they are necessary to give you a better overview and explanation what they do.</p>
<h3 id="coding">Coding</h3>
<p>All of the important <strong>Coding</strong> happens after the head and the preamble are written and run in <code>R</code>. Basically, this is the rest of this document.</p>
<h2 id="downloading-ndvi-data">Downloading NDVI Data</h2>
<p>First of all, we need to download the NDVI data that we are interested in. One particularly useful repository for this is the Global Inventory Modelling and Mapping Studies (GIMMS) 3g v.1 data set obtained via the Advanced Very High Resolution Radiometer (AVHRR). This time series goes back all the way to January 1982 and contains bi-weekly, global projects of NDVI values.</p>
<h3 id="packages">Packages</h3>
<p>Firstly, we need some packages:</p>
<ul>
<li><code>gimms</code> is a package which enables us to download the GIMMS 3g v.1 data set directly through <code>R</code></li>
<li><code>raster</code> is a package which allows us to establish, handle, and save spatial gridded products of any variable we want (NDVI in this case)<br>
We install and load our packages as follows:</li>
</ul>
<pre><code class="language-r">install.packages(&quot;gimms&quot;) # for GIMMS NDVI data download
library(gimms)
install.packages(&quot;raster&quot;) # for spatial raster format
library(raster)
</code></pre>
<h3 id="downloading">Downloading</h3>
<p>Let&rsquo;s download the GIMMS 3g v.1 NDVI data for the entire year of 1982:</p>
<pre><code class="language-r">gimms_files &lt;- downloadGimms(x = as.Date(&quot;1982-01-01&quot;), # download from January 1982
                             y = as.Date(&quot;1982-12-31&quot;), # download to December 1982
                             dsn = Dir.Data, # save downloads in data folder
                             quiet = FALSE # show download progress
                             )
</code></pre>
<p>Now, we want to turn our downloaded data into a raster so we can do spatial analyses with it:</p>
<pre><code class="language-r">gimms_raster &lt;- rasterizeGimms(x = gimms_files, # the data we rasterize
                               remove_header = TRUE # we don't need the header of the data
                               )
gimms_raster # some information about the raster stack we created here
</code></pre>
<pre><code>## class      : RasterStack 
## dimensions : 2160, 4320, 9331200, 24  (nrow, ncol, ncell, nlayers)
## resolution : 0.083, 0.083  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## names      : ndvi.1.1, ndvi.2.1, ndvi.3.1, ndvi.4.1, ndvi.5.1, ndvi.6.1, ndvi.7.1, ndvi.8.1, ndvi.9.1, ndvi.10.1, ndvi.11.1, ndvi.12.1, ndvi.1.2, ndvi.2.2, ndvi.3.2, ... 
## min values :     -0.3,     -0.3,     -0.3,     -0.3,     -0.3,     -0.3,     -0.3,     -0.3,     -0.3,      -0.3,      -0.3,      -0.3,     -0.3,     -0.3,     -0.3, ... 
## max values :     0.99,     0.99,     1.00,     0.99,     0.99,     0.99,     1.00,     1.00,     0.99,      0.99,      1.00,      1.00,     1.00,     1.00,     1.00, ...
</code></pre>
<p>Here, you can see that we have successfully created a <code>RasterStack</code> with 24 layers (two for each month because measurements were bi-weekly), for the entire earth (extent of -180, 180, -90, 90). We can also see that there are some values below 0 which we don&rsquo;t expect for the NDVI and we will fix this in a second. For now, just notice that we have successfully downloaded the data.</p>
<h2 id="aggregating-ndvi-data">Aggregating NDVI Data</h2>
<p>With our data successfully downloaded, it is now time to prepare the data further for our analysis.</p>
<h3 id="composites">Composites</h3>
<p>Firstly, we want to deal with monthly NDVI values. To do so, we want to build monthly maximum composites. Luckily, the <code>gimms</code> package has just the right option for us:</p>
<pre><code class="language-r">indices &lt;- monthlyIndices(gimms_files) # generate month indices from the data
gimms_raster_mvc &lt;- monthlyComposite(gimms_raster, # the data
                                     indices = indices # the indices
                                     )
gimms_raster_mvc # some information about our monthly composite raster stack
</code></pre>
<pre><code>## class      : RasterStack 
## dimensions : 2160, 4320, 9331200, 12  (nrow, ncol, ncell, nlayers)
## resolution : 0.083, 0.083  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## names      : index_1.1, index_1.2, index_1.3, index_1.4, index_1.5, index_1.6, index_1.7, index_1.8, index_1.9, index_1.10, index_1.11, index_1.12 
## min values :     -0.30,     -0.30,     -0.30,     -0.29,     -0.30,     -0.30,     -0.30,     -0.30,     -0.30,      -0.30,      -0.30,      -0.30 
## max values :      0.99,      1.00,      0.99,      1.00,      0.99,      1.00,      1.00,      1.00,      1.00,       1.00,       0.99,       0.99
</code></pre>
<p>As you can see above, our new raster stack has the same dimensions, resolution, coordinate reference system (crs), and extent as the previous one. However, we have reduced the number of layers to 12 (one for each month).</p>
<p>Since there are still negative values present (an artifact of how NASA stores the data or cloud cover), we simply set these to 0:</p>
<pre><code class="language-r">Negatives &lt;- which(values(gimms_raster_mvc) &lt; 0) # identify all negative values
values(gimms_raster_mvc)[Negatives] &lt;- 0 # set threshold for barren land (NDVI&lt;0)
gimms_raster_mvc
</code></pre>
<pre><code>## class      : RasterBrick 
## dimensions : 2160, 4320, 9331200, 12  (nrow, ncol, ncell, nlayers)
## resolution : 0.083, 0.083  (x, y)
## extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : index_1.1, index_1.2, index_1.3, index_1.4, index_1.5, index_1.6, index_1.7, index_1.8, index_1.9, index_1.10, index_1.11, index_1.12 
## min values :         0,         0,         0,         0,         0,         0,         0,         0,         0,          0,          0,          0 
## max values :      0.99,      1.00,      0.99,      1.00,      0.99,      1.00,      1.00,      1.00,      1.00,       1.00,       0.99,       0.99
</code></pre>
<p>See how all of the <code>min values</code> are now on 0!</p>
<p>Lastly, we want to see what our data looks like (visual inspection is an important step to sanity check your work). We do so as follows:</p>
<pre><code class="language-r">plot(gimms_raster_mvc)
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Aggr3-1.png" width="1152" /></p>
<p>What a beautiful seasonal trend of greening we can observe (I&rsquo;ll stop nerding out here before it get&rsquo;s out of hand, don&rsquo;t worry)!</p>
<h3 id="annual-values">Annual Values</h3>
<p>Lastly, we may wish (and in fact, you will have to) aggregate our data to annual and even more-than-annual means and seasonality measures.</p>
<h4 id="mean-values">Mean Values</h4>
<p>To establish annual mean values, we simply take the mean for each cell in our raster stack for all the layers as such:</p>
<pre><code class="language-r">gimms_annual &lt;- calc(gimms_raster_mvc, # data from which to calculate
                     fun=mean, # function which to calculate with
                     na.rm = TRUE # ignore NAs
                     )
</code></pre>
<h4 id="seasonality-values">Seasonality Values</h4>
<p>Measures of seasonality are defined as the span between the maximum value of a cell and the minimum value of the same cell. So, we calculate a maximum raster and a minimum raster and then simply subtract the minimum from the maximum as follows:</p>
<pre><code class="language-r">maxi &lt;- calc(gimms_raster_mvc, fun=max)
mini &lt;- calc(gimms_raster_mvc, fun=min)
gimms_seasonality &lt;- maxi-mini
</code></pre>
<p>\pagebreak</p>
<h4 id="plots">Plots</h4>
<p>Let&rsquo;s have a look at our annual mean and seasonality:</p>
<pre><code class="language-r">plot(gimms_annual, main = &quot;Mean&quot;)
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Aggr6-1.png" width="1152" /></p>
<pre><code class="language-r">plot(gimms_seasonality, main = &quot;Seasonality&quot;)
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Aggr6-2.png" width="1152" /></p>
<h2 id="cropping-ndvi-data">Cropping NDVI Data</h2>
<p>Our data is still on a global scale. We are only interested in data across Alaska, though. Let&rsquo;s deal with that.</p>
<h3 id="packages--data">Packages &amp; Data</h3>
<p>Again, we have to install some packages and load them.</p>
<pre><code class="language-r">install.packages(&quot;sp&quot;) # for spatialpolygons format
library(sp)
install.packages(&quot;rgdal&quot;) # for shapefiles
library(rgdal)
</code></pre>
<p>Secondly, we require the actual shape files. Personally, I am a big fan of the Natural Earth Shape files (\url{http://www.naturalearthdata.com/downloads/10m-cultural-vectors/}) because of all the different shape files I can get there. Here, we are interested in states/provinces and so want to download the data from here: \url{https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip}. Thankfully, <code>R</code>let&rsquo;s us do the downloading as well as the unpacking of archived (.zip) data:</p>
<pre><code class="language-r"># Downloading
download.file(&quot;https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip&quot;,
              destfile = paste(Dir.Data, &quot;Shapes.zip&quot;, sep=&quot;/&quot;)) # destination file
# Unzipping
unzip(paste(Dir.Data, &quot;Shapes.zip&quot;, sep=&quot;/&quot;), # which file to unzip
      exdir = Dir.Data) # where to unzip to
</code></pre>
<p>Finally, we want to load our shape files into <code>R</code>. We do this using the <code>readOGR()</code> function in <code>R</code>:</p>
<pre><code class="language-r">Shapes &lt;- readOGR(Dir.Data, # where to look for the file
                  &quot;ne_10m_admin_1_states_provinces&quot;, # the file name
                  verbose = FALSE) # we don't want an overview of the loaded data
</code></pre>
<h3 id="crop--mask">Crop &amp; Mask</h3>
<p>Now, we are ready to use our shape file for Alaska. First, we have to find out which of our shape files is for Alaska:</p>
<pre><code class="language-r">Position &lt;- which(Shapes$name_en == &quot;Alaska&quot;) # find the english name that's &quot;Alaska&quot; in our shapefiles
Alaska_Shp &lt;- Shapes[Position,] # extract the Alaska shapefile
plot(Alaska_Shp) # plot it for inspection
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Crop4-1.png" width="1152" />
We really don&rsquo;t care much about that island chain all the way to the right in our plot.</p>
<p>This is likely to be an extent-caused issue and we should crop our shape file extent to the easternmost point of Alaska on the continent:</p>
<pre><code class="language-r">extent(Alaska_Shp) # extent clearly shows the super-eastern coordinates
</code></pre>
<pre><code>## class      : Extent 
## xmin       : -179 
## xmax       : 180 
## ymin       : 51 
## ymax       : 71
</code></pre>
<pre><code class="language-r"># Crop
Alaska_Shp &lt;- crop(Alaska_Shp, # what to crop
                   extent(-190, -130, 51, 71)) # which extent to crop to
plot(Alaska_Shp) # visualising the cropped product
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Crop5-1.png" width="1152" /></p>
<p>Lovely. That resolved the issue. We are ready for final cropping of our data and saving of the cropped data.</p>
<h4 id="mean-values-1">Mean Values</h4>
<p>Let&rsquo;s deal with the annual mean for 1982:</p>
<pre><code class="language-r"># Crop
gimms_annual &lt;- crop(gimms_annual, # mean annual data
                     extent(Alaska_Shp)) # cropped Alaska extent
# Mask (this keeps only cells that fall into our shapefile)
gimms_annual &lt;- mask(gimms_annual, # cropped annual means
                     Alaska_Shp) # cropped Alaska shapefile
plot(gimms_annual, main =&quot;Annual Mean 1982&quot;) # inspection time!
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Crop6-1.png" width="1152" /></p>
<pre><code class="language-r"># Save data
writeRaster(x = gimms_annual, # which raster to save
            file = paste(Dir.Data, &quot;1982Mean&quot;, sep=&quot;/&quot;), # which file to save to
            format = &quot;CDF&quot;, overwrite = TRUE) # which format to use and whether to overwrite
</code></pre>
<pre><code>## class      : RasterLayer 
## dimensions : 237, 590, 139830  (nrow, ncol, ncell)
## resolution : 0.083, 0.083  (x, y)
## extent     : -179, -130, 51, 71  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : 1982Mean.nc 
## names      : layer 
## values     : 0, 0.84  (min, max)
## zvar       : layer
</code></pre>
<h4 id="seasonality-values-1">Seasonality Values</h4>
<pre><code class="language-r"># Crop
gimms_seasonality &lt;- crop(gimms_seasonality, # mean seasonality data
                     extent(Alaska_Shp)) # cropped Alaska extent
# Mask (this keeps only cells that fall into our shapefile)
gimms_seasonality &lt;- mask(gimms_seasonality, # cropped seasonality data
                     Alaska_Shp) # cropped Alaska shapefile
plot(gimms_seasonality, main = &quot;Seasonality 1982&quot;) # inspection time!
</code></pre>
<p><img src="01---data_allocation_files/figure-html/Crop7-1.png" width="1152" /></p>
<pre><code class="language-r"># Save data
writeRaster(x = gimms_seasonality, # which raster to save
            file = paste(Dir.Data, &quot;1982Season&quot;, sep=&quot;/&quot;), # which file to save to
            format = &quot;CDF&quot;, overwrite = TRUE) # which format to use and whether to overwrite
</code></pre>
<pre><code>## class      : RasterLayer 
## dimensions : 237, 590, 139830  (nrow, ncol, ncell)
## resolution : 0.083, 0.083  (x, y)
## extent     : -179, -130, 51, 71  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : 1982Season.nc 
## names      : layer 
## values     : 0, 1  (min, max)
## zvar       : layer
</code></pre>

          </div>

          

<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/r/">R</a>
  
  <a class="badge badge-light" href="/tag/statistics/">Statistics</a>
  
  <a class="badge badge-light" href="/tag/remote-sensing/">Remote Sensing</a>
  
</div>



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/bftp-biome-detection/cluster-analysis/" rel="prev">Cluster Analysis</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on 2020-06-10</p>

          





          


          


  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/courses/bftp-biome-detection/change-analysis/">Change Analysis</a></li>
      
      <li><a href="/courses/bftp-biome-detection/cluster-analysis/">Cluster Analysis</a></li>
      
      <li><a href="/courses/excursions-into-biostatistics/classifications-order-from-chaos/">Classifications</a></li>
      
      <li><a href="/courses/excursions-into-biostatistics/data-handling-and-data-assumptions/">Data Handling and Data Assumptions</a></li>
      
      <li><a href="/courses/excursions-into-biostatistics/excursion-into-biostatistics/">Model Selection</a></li>
      
    </ul>
  </div>
  



        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    © 2024
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/latex.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.66c553246b0f279a03be6e5597f72b52.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
